<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Diwali Wish for You!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400..900&family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <style>
        /* General Styles */
        :root {
            --bg-dark: #020208;
            --bg-light: #1a1a2e;
            --diya-base: #8b4513;
            --diya-highlight: #b55e00;
            --flame-yellow: #FFD700;
            --flame-orange: #ffac41;
            --flame-red: #ff4500;
            --text-light: #f0e6d2;
            --text-gold: #FFD700;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            overflow: hidden;
            transition: background-color 3s ease-in-out;
            position: relative;
        }

        /* Animated Starry Background */
        #star-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0;
            transition: opacity 3s ease-in-out;
        }

        body.light #star-field {
            opacity: 1;
        }
        
        /* Main Content Container */
        .container {
            text-align: center;
            z-index: 10;
            position: relative;
            padding: 20px;
            max-width: 95%;
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Instructions */
        #instructions {
            font-size: 1.5rem;
            font-weight: 300;
            color: #ccc;
            margin-bottom: 40px;
            opacity: 1;
            transition: opacity 1s ease, transform 1s ease;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.4));
            transform: translateY(0);
        }
        body.light #instructions {
            opacity: 0;
            transform: translateY(-20px);
        }

        /* Diya Container */
        .diya-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 40px;
            margin: 60px 0;
            perspective: 1000px;
        }

        /* More Realistic Diya Styling */
        .diya {
            width: 110px;
            height: 65px;
            background: radial-gradient(ellipse at top, var(--diya-highlight) 0%, var(--diya-base) 80%, #5a2e00 100%);
            border-radius: 50% / 100% 100% 0 0;
            position: relative;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: inset 0 -10px 15px rgba(0, 0, 0, 0.7), 0 5px 20px rgba(0, 0, 0, 0.6);
            transform: scale(0.95) rotateY(-10deg);
        }
        .diya:hover {
            transform: translateY(-10px) scale(1.05) rotateY(0deg);
            box-shadow: inset 0 -10px 15px rgba(0, 0, 0, 0.7), 0 12px 30px rgba(0, 0, 0, 0.8);
        }

        .diya::before { /* Wick Base */
            content: '';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 22px;
            background: linear-gradient(to top, #4a4a4a 0%, #2a2a2a 100%);
            border-radius: 4px 4px 0 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
            transition: all 0.5s ease;
        }

        /* Lit Diya State - More Realistic Flame and Glow */
        .diya.lit {
            opacity: 1;
            transform: scale(1) rotateY(0deg);
            box-shadow: inset 0 -8px 15px rgba(0, 0, 0, 0.7),
                        0 0 35px rgba(255, 165, 0, 0.8),
                        0 0 65px rgba(255, 140, 0, 0.6);
        }
        .diya.lit::before { /* Flame */
            background: transparent; /* Wick disappears into flame */
            box-shadow: none;
        }
        
        .flame {
            position: absolute;
            width: 22px;
            height: 50px;
            bottom: 30px;
            left: 50%;
            transform-origin: 50% 100%;
            transform: translateX(-50%);
            background: radial-gradient(circle at 50% 90%, var(--flame-yellow) 10%, var(--flame-orange) 60%, var(--flame-red) 95%);
            border-radius: 50% 50% 20% 20%;
            filter: blur(2px) brightness(1.2);
            box-shadow: 0 0 15px var(--flame-yellow), 
                        0 0 30px var(--flame-orange), 
                        0 0 50px var(--flame-red),
                        0 0 80px rgba(255, 215, 0, 0.5);
            animation: subtle-flicker 1.5s infinite alternate ease-in-out;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .diya.lit .flame {
            opacity: 1;
        }

        @keyframes subtle-flicker {
            0% { transform: translateX(-50%) scale(1, 1); }
            50% { transform: translateX(-45%) scale(1.05, 0.95); }
            100% { transform: translateX(-55%) scale(0.98, 1.02); }
        }

        /* --- Rangoli SVG Styling --- */
        #rangoli-svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vmin;
            height: 90vmin;
            max-width: 500px;
            max-height: 500px;
            z-index: 8;
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        body.rangoli-active #rangoli-svg {
            opacity: 0.8;
        }

        #rangoli-svg path {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }
        
        body.rangoli-active #rangoli-svg .path1 { animation: draw-rangoli 4s ease-out 0.5s forwards; stroke: #ff5733; }
        body.rangoli-active #rangoli-svg .path2 { animation: draw-rangoli 4s ease-out 1s forwards; stroke: #33ff57; }
        body.rangoli-active #rangoli-svg .path3 { animation: draw-rangoli 4s ease-out 1.5s forwards; stroke: #3357ff; }
        body.rangoli-active #rangoli-svg .path4 { animation: draw-rangoli 4s ease-out 2s forwards; stroke: #ff33a1; }


        @keyframes draw-rangoli {
            to {
                stroke-dashoffset: 0;
            }
        }


        /* Wish Message Styling */
        #wish-message {
            opacity: 0;
            transform: translate(-50%, -50%) translateY(50px) scale(0.9);
            transition: opacity 2s ease, transform 2s ease;
            position: fixed;
            top: 50%;
            left: 50%;
            width: 90%;
            max-width: 750px;
            padding: 40px;
            background: rgba(10, 5, 20, 0.5);
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            border-radius: 20px;
            box-shadow: 0 0 60px rgba(255, 180, 0, 0.8), inset 0 0 20px rgba(255, 215, 0, 0.2);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
            pointer-events: none;
            border: 1px solid rgba(255, 215, 0, 0.3);
            z-index: 100;
        }
        #wish-message.visible {
            opacity: 1;
            transform: translate(-50%, -50%) translateY(0) scale(1);
        }

        #wish-message h1 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2.5rem, 10vw, 5rem);
            color: var(--text-gold);
            margin-bottom: 20px;
            text-shadow: 0 0 15px var(--text-gold), 0 0 25px var(--flame-orange);
            letter-spacing: 2px;
        }

        #wish-message p {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1rem, 4vw, 1.5rem);
            line-height: 1.8;
            color: #fcefdc;
            margin: 25px auto 35px;
            max-width: 600px;
        }

        #wish-message h3 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.5rem, 6vw, 2.5rem);
            color: var(--flame-orange);
            margin-top: 30px;
            text-shadow: 0 0 15px var(--flame-orange);
        }
        
        /* Dynamic JS-Powered Fireworks */
        #fireworks-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
            display: none; /* Hidden by default */
        }
        
        body.fireworks-active #fireworks-container {
            display: block;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 1;
        }

    </style>
</head>
<body>
    <canvas id="star-field"></canvas>
    <div id="fireworks-container"></div>
    
    <svg id="rangoli-svg" viewBox="0 0 400 400">
        <!-- A simple geometric Rangoli design -->
        <defs>
            <path id="petal" d="M200 10 C 250 50, 250 150, 200 190 C 150 150, 150 50, 200 10 Z" />
        </defs>
        <g class="path1">
            <circle cx="200" cy="200" r="100" />
            <circle cx="200" cy="200" r="80" />
        </g>
        <g class="path2">
            <use href="#petal" transform="rotate(0 200 200)" />
            <use href="#petal" transform="rotate(90 200 200)" />
            <use href="#petal" transform="rotate(180 200 200)" />
            <use href="#petal" transform="rotate(270 200 200)" />
        </g>
        <g class="path3">
            <use href="#petal" transform="rotate(45 200 200) scale(0.7)" />
            <use href="#petal" transform="rotate(135 200 200) scale(0.7)" />
            <use href="#petal" transform="rotate(225 200 200) scale(0.7)" />
            <use href="#petal" transform="rotate(315 200 200) scale(0.7)" />
        </g>
         <g class="path4">
            <circle cx="200" cy="200" r="30" />
        </g>
    </svg>

    <div class="container">
        <p id="instructions">Light the path to joy, click each diya...</p>
        
        <div class="diya-container">
            <div class="diya"></div>
            <div class="diya"></div>
            <div class="diya"></div>
            <div class="diya"></div>
            <div class="diya"></div>
        </div>

        <div id="wish-message">
            <h1>Happy Diwali!</h1>
            <p>
                My Friend,
                <br><br>
                On this Diwali, as these lamps push back the darkness, I'm reminded of the incredible light you bring into my world. For me, the real festival isn't just the fireworks in the sky, but the warmth of the bond we share.
                <br><br>
                I hope this festival ignites a new spark of inspiration in you, fills your heart with pure happiness, and lights up the path to all your dreams. Wishing you a Diwali that's as genuinely bright and beautiful as you are.
            </p>
            <h3>Your friend, <br> Aman Balara</h3>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const diyas = document.querySelectorAll('.diya');
            const instructions = document.getElementById('instructions');
            const wishMessage = document.getElementById('wish-message');
            const body = document.body;
            const fireworksContainer = document.getElementById('fireworks-container');
            const starField = document.getElementById('star-field');
            const starCtx = starField.getContext('2d');

            let litCount = 0;
            const totalDiyas = diyas.length;
            let audioStarted = false;
            
            // --- Audio Setup (Tone.js) ---
            const reverb = new Tone.Reverb({
                decay: 4,
                preDelay: 0.01,
                wet: 0.4
            }).toDestination();

            const synth = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "fatsawtooth" },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.5 },
                volume: -15
            }).connect(reverb);
            
            const bgMusic = new Tone.Loop(time => {
                const notes = ["C4", "E4", "G4", "A4", "G4", "E4"];
                const note = notes[Math.floor(Math.random() * notes.length)];
                synth.triggerAttackRelease(note, "8n", time);
            }, "1n");
            bgMusic.humanize = true;


            // --- Starry Background ---
            let stars = [];
            let canvasSize = { w: 0, h: 0 };

            function setupStars() {
                canvasSize.w = window.innerWidth;
                canvasSize.h = window.innerHeight;
                starField.width = canvasSize.w;
                starField.height = canvasSize.h;
                stars = [];
                for (let i = 0; i < 200; i++) {
                    stars.push({
                        x: Math.random() * canvasSize.w,
                        y: Math.random() * canvasSize.h,
                        size: Math.random() * 1.5 + 0.5,
                        opacity: Math.random() * 0.5 + 0.5,
                        twinkleSpeed: Math.random() * 0.02
                    });
                }
            }

            function drawStars() {
                starCtx.clearRect(0, 0, canvasSize.w, canvasSize.h);
                stars.forEach(star => {
                    star.opacity += Math.sin(Date.now() * star.twinkleSpeed) * 0.005;
                    star.opacity = Math.max(0.2, Math.min(1, star.opacity));

                    starCtx.beginPath();
                    starCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    starCtx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                    starCtx.fill();
                });
                requestAnimationFrame(drawStars);
            }
            
            window.addEventListener('resize', setupStars);
            setupStars();
            drawStars();

            // --- Diya Lighting Logic ---
            diyas.forEach(diya => {
                diya.addEventListener('click', async () => {
                    if (!audioStarted) {
                        await Tone.start();
                        console.log("Audio context started");
                        audioStarted = true;
                    }
                
                    if (!diya.classList.contains('lit')) {
                        diya.classList.add('lit');
                        
                        const flame = document.createElement('div');
                        flame.className = 'flame';
                        diya.appendChild(flame);
                        
                        synth.triggerAttackRelease("C5", "8n");
                        litCount++;

                        const progress = litCount / totalDiyas;
                        body.style.backgroundColor = `rgb(${2 + 24 * progress}, ${2 + 24 * progress}, ${8 + 34 * progress})`;
                    }

                    if (litCount === totalDiyas && !body.classList.contains('light')) {
                        body.classList.add('light');
                        instructions.style.opacity = '0';
                        
                        // Start the main celebration after a short delay
                        setTimeout(() => {
                           body.classList.add('fireworks-active');
                           body.classList.add('rangoli-active');

                           if (Tone.Transport.state !== 'started') {
                               Tone.Transport.start();
                               bgMusic.start(0);
                           }
                           // More frequent fireworks
                           setInterval(createFirework, 600 + Math.random() * 800);
                        }, 1800);

                        // Show the message after the rangoli and fireworks have had time to display
                        setTimeout(() => {
                            wishMessage.classList.add('visible');
                        }, 6800); // 1.8s base delay + 5s for the show
                    }
                });
            });

            // --- Dynamic Fireworks ---
            function createFirework() {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight * 0.7;
                const hue = Math.random() * 360;
                const particleCount = 60 + Math.random() * 60; // More particles
                
                for(let i = 0; i < particleCount; i++) {
                    createParticle(x, y, hue);
                }
            }

            function createParticle(x, y, hue) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 3 + 1.5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 180 + 50; // Bigger bursts
                const translateX = Math.cos(angle) * distance;
                const translateY = Math.sin(angle) * distance;
                
                particle.style.backgroundColor = `hsl(${hue + (Math.random() * 60 - 30)}, 100%, ${60 + Math.random() * 20}%)`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;

                const animation = particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${translateX}px, ${translateY}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 1200 + Math.random() * 600,
                    easing: 'cubic-bezier(0.1, 0.5, 0.5, 1)'
                });
                
                animation.onfinish = () => particle.remove();
                
                fireworksContainer.appendChild(particle);
            }
        });
    </script>
</body>
</html>

